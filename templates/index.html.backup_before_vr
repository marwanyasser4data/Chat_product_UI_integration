<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ 'rtl' if lang == 'ar' else 'ltr' }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataScienve - LLM Chat</title>
    <link rel="stylesheet" id="themeStylesheet" href="{{ url_for('static', filename='style-' + theme + '.css') }}">
    <link rel="stylesheet" href="/custom-theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo" style="justify-content: center;">
                    {% if custom_theme and custom_theme.logo and custom_theme.logo.type == 'image' and
                    custom_theme.logo.url %}
                    <div class="logo-icon"
                        style="background: transparent !important; width: 120px; height: 120px; border-radius: 0;">
                        <img src="{{ custom_theme.logo.url }}" alt="Logo"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    {% else %}
                    <div class="logo-icon">{{ custom_theme.logo.text if custom_theme and custom_theme.logo and
                        custom_theme.logo.text else 'DS' }}</div>
                    {% endif %}
                </div>
            </div>

            <button class="new-chat-btn" onclick="newChat()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14" />
                </svg>
                <span data-i18n="newChat">ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ</span>
            </button>

            <div class="chat-history">
                <div class="history-header">
                    <h3 class="history-title" data-i18n="chatHistory">ุณุฌู ุงููุญุงุฏุซุงุช</h3>
                    <button class="clear-history-btn" onclick="clearAllHistory()" title="ุญุฐู ุงููู">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="sidebar-footer">
                <!-- Language Toggle -->
                <button class="lang-toggle-btn" onclick="toggleLanguage()"
                    title="{{ 'Switch to English' if lang == 'ar' else 'ุชุบููุฑ ููุนุฑุจูุฉ' }}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path
                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1 4-10 15.3 15.3 0 0 1 4-10z">
                        </path>
                    </svg>
                    <span class="lang-code">{{ 'EN' if lang == 'ar' else 'AR' }}</span>
                </button>

                {% if user_role == 'admin' %}
                <button class="settings-btn" onclick="showSettingsModal()" title="ุงูุฅุนุฏุงุฏุงุช">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24" />
                    </svg>
                </button>
                {% endif %}
                <button class="logout-btn" onclick="logout()" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="chat-header">
                <div class="header-content">
                    <h1 class="header-title" data-i18n="appTitle">ูุณุงุนุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h1>
                    <p class="header-subtitle" data-i18n="appSubtitle">ูุณุงุนุฏ ุฐูู ูุชูุฏู ูุฎุฏูุชู</p>
                </div>
                <div class="header-actions">
                    {% if user_role == 'admin' %}
                    <button class="action-btn dashboard-btn" onclick="window.location.href='/admin/dashboard'"
                        title="ููุญุฉ ุงูุชุญูู">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" />
                            <path d="M2 17l10 5 10-5" />
                            <path d="M2 12l10 5 10-5" />
                        </svg>
                        <span>ููุญุฉ ุงูุชุญูู</span>
                    </button>
                    {% endif %}
                    <button class="action-btn reset-btn" onclick="newChat()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                            <path d="M21 3v5h-5" />
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                            <path d="M3 21v-5h5" />
                        </svg>
                        <span data-i18n="resetSession">ุฅุนุงุฏุฉ ุชุนููู</span>
                    </button>
                </div>
            </header>

            <!-- Chat Container -->
            <div class="chat-container" id="chatContainer">
                <div class="welcome-message" id="welcomeMessage">
                    <div class="ai-badge">AI</div>
                    <h2 class="welcome-title" data-i18n="welcomeTitle">ูุฑุญุจุงู ุจู ูู ุงููุณุงุนุฏ ุงูุฐูู! ๐</h2>
                    <p class="welcome-description" data-i18n="welcomeDescription">
                        ูููููู ูุณุงุนุฏุชู ูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ูุชูุฏูู ุงููุนูููุงุช ุงูุชู ุชุญุชุงุฌูุง.
                    </p>
                    <div class="welcome-features">
                        <div class="feature-item" data-i18n="feature1">
                            ๐ ุงุณุชูุดุงู ุงูุจูุงูุงุช ูุงููุนูููุงุช
                        </div>
                        <div class="feature-item" data-i18n="feature2">
                            ๐ ุงูุจุญุซ ูุงูุชุญููู ุงููุชูุฏู
                        </div>
                    </div>
                    <div class="suggestions-label" data-i18n="suggestionsLabel">ุฌุฑุจ ุฃุญุฏ ูุฐู ุงูุฃุณุฆูุฉ:</div>
                    <div class="suggestions">
                        <button class="suggestion-btn" onclick="sendSuggestion(t('suggestion1'))">
                            <span data-i18n="suggestion1">ูุง ูู ุฎุฏูุงุช NHCุ</span>
                        </button>
                        <button class="suggestion-btn" onclick="sendSuggestion(t('suggestion2'))">
                            <span data-i18n="suggestion2">ููู ูููููู ุญุฌุฒ ูุญุฏุฉ ุณูููุฉุ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <form id="chatForm" onsubmit="sendMessage(event)">
                    <div class="input-container">
                        <textarea id="messageInput" data-i18n="placeholder" placeholder="ุงุณุฃู ุฃู ุดูุก..." rows="1"
                            onkeydown="handleKeyPress(event)"></textarea>
                        <div class="input-actions">
                            <button type="button" class="icon-btn" title="ุฅุฑูุงู ููู">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                                </svg>
                            </button>
                            <button type="button" class="icon-btn" title="ุชุณุฌูู ุตูุชู">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                    <line x1="12" y1="19" x2="12" y2="23" />
                                    <line x1="8" y1="23" x2="16" y2="23" />
                                </svg>
                            </button>
                            <button type="submit" class="send-btn" id="sendBtn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                                </svg>
                                <span data-i18n="send">ุฅุฑุณุงู</span>
                            </button>
                        </div>
                    </div>
                    <div class="input-hint" data-i18n="inputHint">
                        ุงุถุบุท Enter ููุฅุฑุณุงู โข Shift + Enter ูุณุทุฑ ุฌุฏูุฏ
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-overlay" onclick="hideSettingsModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="settingsTitle">ุฅุนุฏุงุฏุงุช ุงููููุฐุฌ</h2>
                <button class="modal-close" onclick="hideSettingsModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Theme Selection -->
                <div class="form-group">
                    <label class="form-label" data-i18n="themeLabel">ุชุตููู ุงููุงุฌูุฉ</label>
                    <div class="theme-selector">
                        <div class="theme-option" data-theme="nhc" onclick="selectTheme('nhc')">
                            <div class="theme-preview theme-nhc">
                                <div class="preview-sidebar"></div>
                                <div class="preview-main">
                                    <div class="preview-header"></div>
                                    <div class="preview-message"></div>
                                    <div class="preview-message user"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name" data-i18n="themeNHC">NHC Professional</div>
                                <div class="theme-desc" data-i18n="themeNHCDesc">ุชุตููู ุงุญุชุฑุงูู ุจุฃููุงู NHC</div>
                            </div>
                            <div class="theme-check">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="3">
                                    <polyline points="20 6 9 17 4 12" />
                                </svg>
                            </div>
                        </div>
                        <div class="theme-option" data-theme="readpo" onclick="selectTheme('readpo')">
                            <div class="theme-preview theme-readpo">
                                <div class="preview-sidebar"></div>
                                <div class="preview-main">
                                    <div class="preview-header"></div>
                                    <div class="preview-message"></div>
                                    <div class="preview-message user"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name" data-i18n="themeReadpo">ReadPo Minimal</div>
                                <div class="theme-desc" data-i18n="themeReadpoDesc">ุชุตููู ุจุณูุท ููุงุฏุฆ ูููุฑุงุกุฉ</div>
                            </div>
                            <div class="theme-check">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="3">
                                    <polyline points="20 6 9 17 4 12" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideSettingsModal()" data-i18n="save">ุญูุธ</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Initialize translations
        const translations = {
            ar: {
                appTitle: 'ูุณุงุนุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู',
                appSubtitle: 'ูุณุงุนุฏ ุฐูู ูุชูุฏู ูุฎุฏูุชู',
                newChat: 'ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ',
                chatHistory: 'ุณุฌู ุงููุญุงุฏุซุงุช',
                noHistory: 'ูุง ุชูุฌุฏ ูุญุงุฏุซุงุช ุณุงุจูุฉ',
                welcomeTitle: 'ูุฑุญุจุงู ุจู ูู ุงููุณุงุนุฏ ุงูุฐูู! ๐',
                welcomeDescription: 'ูููููู ูุณุงุนุฏุชู ูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ูุชูุฏูู ุงููุนูููุงุช ุงูุชู ุชุญุชุงุฌูุง.',
                feature1: '๐ ุงุณุชูุดุงู ุงูุจูุงูุงุช ูุงููุนูููุงุช',
                feature2: '๐ ุงูุจุญุซ ูุงูุชุญููู ุงููุชูุฏู',
                suggestionsLabel: 'ุฌุฑุจ ุฃุญุฏ ูุฐู ุงูุฃุณุฆูุฉ:',
                suggestion1: 'ูุง ูู ุฎุฏูุงุช NHCุ',
                suggestion2: 'ููู ูููููู ุญุฌุฒ ูุญุฏุฉ ุณูููุฉุ',
                placeholder: 'ุงุณุฃู ุฃู ุดูุก...',
                send: 'ุฅุฑุณุงู',
                inputHint: 'ุงุถุบุท Enter ููุฅุฑุณุงู โข Shift + Enter ูุณุทุฑ ุฌุฏูุฏ',
                settingsTitle: 'ุฅุนุฏุงุฏุงุช ุงููููุฐุฌ',
                themeLabel: 'ุชุตููู ุงููุงุฌูุฉ',
                themeNHC: 'NHC Professional',
                themeNHCDesc: 'ุชุตููู ุงุญุชุฑุงูู ุจุฃููุงู NHC',
                themeReadpo: 'ReadPo Minimal',
                themeReadpoDesc: 'ุชุตููู ุจุณูุท ููุงุฏุฆ ูููุฑุงุกุฉ',
                languageLabel: 'ุงููุบุฉ',
                save: 'ุญูุธ',
                resetSession: 'ุฅุนุงุฏุฉ ุชุนููู'
            },
            en: {
                appTitle: 'AI Assistant',
                appSubtitle: 'Advanced AI Assistant at your service',
                newChat: 'New Chat',
                chatHistory: 'Chat History',
                noHistory: 'No previous chats',
                welcomeTitle: 'Welcome to AI Assistant! ๐',
                welcomeDescription: 'I can help you answer questions and provide the information you need.',
                feature1: '๐ Data Exploration & Info',
                feature2: '๐ Advanced Search & Analysis',
                suggestionsLabel: 'Try one of these questions:',
                suggestion1: 'What are NHC services?',
                suggestion2: 'How can I book a housing unit?',
                placeholder: 'Ask anything...',
                send: 'Send',
                inputHint: 'Press Enter to send โข Shift + Enter for new line',
                settingsTitle: 'Model Settings',
                themeLabel: 'Interface Theme',
                themeNHC: 'NHC Professional',
                themeNHCDesc: 'Professional design with NHC colors',
                themeReadpo: 'ReadPo Minimal',
                themeReadpoDesc: 'Simple and calm design for reading',
                languageLabel: 'Language',
                save: 'Save',
                resetSession: 'Reset'
            }
        };

        let currentLang = '{{ lang }}';

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function updateTexts() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translations[currentLang][key];
                    } else {
                        el.textContent = translations[currentLang][key];
                    }
                }
            });

            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = currentLang;

            // Update toggle button state
            const toggleBtn = document.querySelector('.lang-toggle-btn');
            if (toggleBtn) {
                const langCode = toggleBtn.querySelector('.lang-code');
                if (currentLang === 'ar') {
                    toggleBtn.title = 'Switch to English';
                    if (langCode) langCode.textContent = 'EN';
                } else {
                    toggleBtn.title = 'ุชุบููุฑ ููุนุฑุจูุฉ';
                    if (langCode) langCode.textContent = 'AR';
                }
            }
        }

        function toggleLanguage() {
            const newLang = currentLang === 'ar' ? 'en' : 'ar';
            changeLanguage(newLang);
        }

        function changeLanguage(lang) {
            currentLang = lang;
            updateTexts();
            // Save preference
            fetch('/api/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ language: lang })
            });
        }

        function selectTheme(theme) {
            document.getElementById('themeStylesheet').href = `/static/style-${theme}.css`;
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.theme === theme) opt.classList.add('active');
            });
            // Save preference
            fetch('/api/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ theme: theme })
            });
        }

        function showSettingsModal() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function hideSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function logout() {
            if (confirm('ูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
                window.location.href = '/logout';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateTexts();
            // Set active theme
            const currentTheme = '{{ theme }}';
            document.querySelectorAll('.theme-option').forEach(opt => {
                if (opt.dataset.theme === currentTheme) opt.classList.add('active');
            });
        });
    </script>
</body>

</html>
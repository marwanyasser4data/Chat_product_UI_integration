<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ 'rtl' if lang == 'ar' else 'ltr' }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ theme_settings.app_name[lang] if theme_settings.app_name is mapping else theme_settings.app_name or 'AI
        Assistant' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='desktop.css') }}?v={{ timestamp }}">
    <link rel="stylesheet" href="/custom-theme.css?v={{ timestamp }}">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Desktop Background -->
    <div class="desktop-background">
        {% if theme_settings.background_image %}
        <img src="{{ theme_settings.background_image }}" alt="Background" class="bg-image">
        {% endif %}
    </div>

    <!-- Desktop Container -->
    <div class="desktop-container">
        <!-- Top Header Bar -->
        <div class="top-header-bar">
            <div class="header-brand">
                {% if theme_settings.logo.type == 'image' and theme_settings.logo.url %}
                <img src="{{ theme_settings.logo.url }}" alt="Logo" class="header-logo">
                {% else %}
                <div class="header-logo-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z" />
                    </svg>
                </div>
                {% endif %}
                <span class="header-title" id="mainAppTitle">{{ theme_settings.app_name.ar if theme_settings.app_name is
                    mapping else theme_settings.app_name or 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™' }}</span>
            </div>
            <div class="header-right">
                <div class="header-status">
                    <div class="status-dot online"></div>
                    <span>AI Ready</span>
                </div>
                <div class="header-datetime">
                    <span class="header-time" id="headerTime">00:00</span>
                    <span class="header-date" id="headerDate">--/--/----</span>
                </div>
            </div>
        </div>

        <!-- Currency Ticker Marquee -->
        <div class="currency-ticker">
            <div class="ticker-content">
                <span class="ticker-item">
                    <span class="currency-symbol">üíµ</span>
                    <span class="currency-pair">USD/SAR</span>
                    <span class="currency-price up">3.75</span>
                    <span class="currency-change up">+0.02%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">üí∂</span>
                    <span class="currency-pair">EUR/SAR</span>
                    <span class="currency-price down">4.08</span>
                    <span class="currency-change down">-0.15%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">üí∑</span>
                    <span class="currency-pair">GBP/SAR</span>
                    <span class="currency-price up">4.76</span>
                    <span class="currency-change up">+0.08%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">üí¥</span>
                    <span class="currency-pair">JPY/SAR</span>
                    <span class="currency-price">0.025</span>
                    <span class="currency-change">0.00%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">üá¶üá™</span>
                    <span class="currency-pair">AED/SAR</span>
                    <span class="currency-price up">1.02</span>
                    <span class="currency-change up">+0.01%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">üá∞üáº</span>
                    <span class="currency-pair">KWD/SAR</span>
                    <span class="currency-price down">12.23</span>
                    <span class="currency-change down">-0.05%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">‚Çø</span>
                    <span class="currency-pair">BTC/USD</span>
                    <span class="currency-price up">43,250</span>
                    <span class="currency-change up">+2.34%</span>
                </span>
                <span class="ticker-item">
                    <span class="currency-symbol">Œû</span>
                    <span class="currency-pair">ETH/USD</span>
                    <span class="currency-price up">2,285</span>
                    <span class="currency-change up">+1.87%</span>
                </span>
            </div>
        </div>

        <!-- Desktop Widgets Area -->
        <div class="desktop-widgets" id="desktopWidgets">
            <!-- Default Widgets - will be replaced by dynamic widgets if available -->

            <!-- AI Stats Widget -->
            <div class="desktop-widget ai-widget" data-widget-id="ai-models">
                <div class="widget-header">
                    <div class="widget-icon ai-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z" />
                            <circle cx="7.5" cy="14.5" r="1.5" />
                            <circle cx="16.5" cy="14.5" r="1.5" />
                        </svg>
                    </div>
                    <span class="widget-title" data-i18n="aiModels">ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</span>
                </div>
                <div class="widget-body">
                    <div class="model-item active">
                        <div class="model-status online"></div>
                        <div class="model-info">
                            <span class="model-name">GPT-4</span>
                            <span class="model-desc">ŸÖÿ™ÿµŸÑ ‚Ä¢ ÿ¨ÿßŸáÿ≤</span>
                        </div>
                        <span class="model-badge primary">ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</span>
                    </div>
                    <div class="model-item">
                        <div class="model-status online"></div>
                        <div class="model-info">
                            <span class="model-name">Claude 3</span>
                            <span class="model-desc">ŸÖÿ™ÿµŸÑ</span>
                        </div>
                    </div>
                    <div class="model-item">
                        <div class="model-status offline"></div>
                        <div class="model-info">
                            <span class="model-name">Gemini Pro</span>
                            <span class="model-desc">ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Stats Widget -->
            <div class="desktop-widget stats-card-widget" data-widget-id="chat-stats">
                <div class="widget-header">
                    <div class="widget-icon chat-stats-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg>
                    </div>
                    <span class="widget-title" data-i18n="chatStats">ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</span>
                </div>
                <div class="widget-body">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalChats">156</div>
                            <div class="stat-label" data-i18n="totalConversations">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="todayChats">12</div>
                            <div class="stat-label" data-i18n="todayConversations">ŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ÿßŸÑŸäŸàŸÖ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalMessages">1.2K</div>
                            <div class="stat-label" data-i18n="totalMessages">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgResponseTime">1.3s</div>
                            <div class="stat-label" data-i18n="avgResponse">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ©</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status Widget -->
            <div class="desktop-widget system-widget" data-widget-id="system-status">
                <div class="widget-header">
                    <div class="widget-icon system-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                            <line x1="8" y1="21" x2="16" y2="21" />
                            <line x1="12" y1="17" x2="12" y2="21" />
                        </svg>
                    </div>
                    <span class="widget-title" data-i18n="systemStatus">ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ</span>
                </div>
                <div class="widget-body">
                    <div class="system-status-item">
                        <span class="status-label">API</span>
                        <div class="status-bar">
                            <div class="status-fill"
                                style="width: 100%; background: linear-gradient(90deg, #00A651, #00D68F);"></div>
                        </div>
                        <span class="status-value success">ŸÖÿ™ÿµŸÑ</span>
                    </div>
                    <div class="system-status-item">
                        <span class="status-label">CPU</span>
                        <div class="status-bar">
                            <div class="status-fill"
                                style="width: 45%; background: linear-gradient(90deg, #0078D4, #00BCF2);"></div>
                        </div>
                        <span class="status-value">45%</span>
                    </div>
                    <div class="system-status-item">
                        <span class="status-label">Memory</span>
                        <div class="status-bar">
                            <div class="status-fill"
                                style="width: 68%; background: linear-gradient(90deg, #667eea, #764ba2);"></div>
                        </div>
                        <span class="status-value">68%</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Widget -->
            <div class="desktop-widget actions-widget" data-widget-id="quick-actions">
                <div class="widget-header">
                    <div class="widget-icon actions-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                        </svg>
                    </div>
                    <span class="widget-title" data-i18n="quickActions">ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©</span>
                </div>
                <div class="widget-body">
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" onclick="toggleWindow('chatWindow')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                            </svg>
                            <span data-i18n="newChat">ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©</span>
                        </button>
                        <button class="quick-action-btn" onclick="toggleWindow('settingsWindow')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
                            </svg>
                            <span data-i18n="settings">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                        </button>
                        {% if user_role == 'admin' %}
                        <button class="quick-action-btn" onclick="toggleWindow('adminWindow')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                                <path d="M2 17l10 5 10-5" />
                                <path d="M2 12l10 5 10-5" />
                            </svg>
                            <span data-i18n="controlPanel">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</span>
                        </button>
                        {% endif %}
                        <button class="quick-action-btn" onclick="clearHistory()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="3 6 5 6 21 6" />
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                            </svg>
                            <span data-i18n="clearHistory">ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Custom Widgets Container - Dynamic widgets will be added here -->
            <div id="customWidgetsContainer"></div>
        </div>

        <!-- Footer Logo -->
        <div class="desktop-footer-logo">
            {% if theme_settings.logo.type == 'image' and theme_settings.logo.url %}
            <img src="{{ theme_settings.logo.url }}" alt="Logo" class="footer-logo-image">
            {% else %}
            <div class="footer-logo-text">{{ theme_settings.logo.text or 'AI Assistant' }}</div>
            {% endif %}
        </div>

        <!-- Windows Container -->
        <div class="windows-container" id="windowsContainer">
            <!-- Chat Window -->
            <div class="app-window" id="chatWindow" style="display: none;">
                <div class="window-header">
                    <div class="window-title">
                        <div class="window-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                            </svg>
                        </div>
                        <span id="chatWindowTitle">{{ theme_settings.app_name[lang] if theme_settings.app_name is
                            mapping else theme_settings.app_name or 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™' }}</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-btn minimize" onclick="minimizeWindow('chatWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M5 12h14" />
                            </svg>
                        </button>
                        <button class="window-btn maximize" onclick="toggleMaximize('chatWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" />
                            </svg>
                        </button>
                        <button class="window-btn close" onclick="closeWindow('chatWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="window-content">
                    <!-- Sidebar -->
                    <aside class="chat-sidebar">
                        <div class="sidebar-header">
                            <div class="logo">
                                {% if theme_settings.logo.type == 'image' and theme_settings.logo.url %}
                                <img src="{{ theme_settings.logo.url }}" alt="Logo" class="logo-image">
                                {% else %}
                                <div class="logo-icon">{{ theme_settings.logo.text or 'AI' }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <button class="new-chat-btn" onclick="newChat()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 5v14M5 12h14" />
                            </svg>
                            <span data-i18n="newChat">ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©</span>
                        </button>

                        <!-- Sidebar View Toggle -->
                        <div class="sidebar-toggle-container">
                            <button class="sidebar-toggle-btn active" data-view="history"
                                onclick="toggleSidebarView('history')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span data-i18n="history">History</span>
                            </button>
                            <button class="sidebar-toggle-btn" data-view="filters"
                                onclick="toggleSidebarView('filters')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                </svg>
                                <span data-i18n="filters">Filters</span>
                            </button>
                        </div>

                        <div class="chat-history">
                            <div class="history-header">
                                <span data-i18n="chatHistory">ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™</span>
                            </div>
                            <div class="history-list" id="chatHistoryList">
                                <div class="no-history" data-i18n="noHistory">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©</div>
                            </div>
                        </div>

                        <!-- Filters Panel -->
                        <div class="filters-panel" style="display: none;">
                            <div class="filters-header">
                                <div class="filters-title">
                                    <span class="filters-strategy">Alerts for Strategy: strategy_3285879</span>
                                    <span class="filters-count">Showing 9 alert(s)</span>
                                </div>
                                <button class="show-all-btn">
                                    <span>Show All Alerts</span>
                                </button>
                            </div>

                            <div class="filters-search-container">
                                <input type="text" class="filters-search" placeholder="Search actionable entity name..."
                                    oninput="filterEntities(this.value)">
                                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="M21 21l-4.35-4.35" />
                                </svg>
                            </div>

                            <div class="entity-cards-container">
                                <!-- Entity Card 1 -->
                                <div class="entity-card" data-entity-name="Eloise Pace">
                                    <div class="entity-header">
                                        <div class="entity-name">Eloise Pace</div>
                                        <div class="entity-subtitle">Taxpayers</div>
                                    </div>
                                    <div class="entity-details">
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity ID:</span>
                                            <span class="detail-value">1000100</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity Name:</span>
                                            <span class="detail-value">Eloise</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Alert ID:</span>
                                            <span class="detail-value">57a7258-458d-8ec5-65ea1ceb10</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Status:</span>
                                            <span class="status-badge active">Active</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Created:</span>
                                            <span class="detail-value">6/26/2025</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Entity Card 2 -->
                                <div class="entity-card" data-entity-name="Josef Livingston">
                                    <div class="entity-header">
                                        <div class="entity-name">Josef Livingston</div>
                                        <div class="entity-subtitle">Taxpayers</div>
                                    </div>
                                    <div class="entity-details">
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity ID:</span>
                                            <span class="detail-value">1000103</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity Name:</span>
                                            <span class="detail-value">Josef Livingston</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Alert ID:</span>
                                            <span class="detail-value">6d9c1e0b5-661bd45ae0d5</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Status:</span>
                                            <span class="status-badge active">Active</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Created:</span>
                                            <span class="detail-value">6/25/2025</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Entity Card 3 -->
                                <div class="entity-card" data-entity-name="Destiny Cortes">
                                    <div class="entity-header">
                                        <div class="entity-name">Destiny Cortes</div>
                                        <div class="entity-subtitle">Taxpayers</div>
                                    </div>
                                    <div class="entity-details">
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity ID:</span>
                                            <span class="detail-value">1000105</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Entity Name:</span>
                                            <span class="detail-value">Destiny Cortes</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Alert ID:</span>
                                            <span class="detail-value">8f2a3b9c-4d5e-6f7g-8h9i</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Status:</span>
                                            <span class="status-badge active">Active</span>
                                        </div>
                                        <div class="entity-detail-item">
                                            <span class="detail-label">Created:</span>
                                            <span class="detail-value">6/24/2025</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- Chat Area -->
                    <div class="chat-main">
                        <!-- Enhanced Chat Header -->
                        <div class="chat-header-enhanced">
                            <div class="chat-header-left">
                                <div class="chat-ai-indicator">
                                    <div class="ai-pulse-ring"></div>
                                    <div class="ai-avatar-mini">AI</div>
                                </div>
                                <div class="chat-title-info">
                                    <h2 id="chatAppTitle">{{ theme_settings.chat_header_title.ar if
                                        theme_settings.chat_header_title is mapping else
                                        theme_settings.chat_header_title or 'ŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä' }}</h2>
                                    <div class="chat-status-bar">
                                        <span class="status-indicator online"></span>
                                        <span class="status-text" id="chatStatusText" data-i18n="readyToHelp">ÿ¨ÿßŸáÿ≤
                                            ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©</span>
                                        <span class="model-tag" id="currentModelTag">Datascience LLM Model</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-header-actions">
                                <button class="chat-action-btn" onclick="toggleChatSearch()" title="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="11" cy="11" r="8" />
                                        <path d="M21 21l-4.35-4.35" />
                                    </svg>
                                </button>
                                <button class="chat-action-btn" onclick="exportChat()" title="ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <polyline points="7 10 12 15 17 10" />
                                        <line x1="12" y1="15" x2="12" y2="3" />
                                    </svg>
                                </button>
                                <button class="chat-action-btn" onclick="toggleChatSettings()" title="ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="1" />
                                        <circle cx="19" cy="12" r="1" />
                                        <circle cx="5" cy="12" r="1" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Search Bar (Hidden by default) -->
                        <div class="chat-search-bar" id="chatSearchBar" style="display: none;">
                            <div class="search-input-wrapper">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="M21 21l-4.35-4.35" />
                                </svg>
                                <input type="text" id="chatSearchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ..."
                                    onkeyup="searchMessages(this.value)">
                                <span class="search-results-count" id="searchResultsCount"></span>
                                <button class="search-close-btn" onclick="toggleChatSearch()">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M18 6L6 18M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Chat Messages Area -->
                        <div class="chat-messages" id="chatMessages">
                            <div class="welcome-screen" id="welcomeScreen">

                                <h2 class="app-title" id="welcomeAppTitle">{{ theme_settings.app_name[lang] if
                                    theme_settings.app_name is mapping else theme_settings.app_name or 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ°
                                    ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™' }}</h2>
                                <p class="welcome-subtitle" data-i18n="welcomeMessage">ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü
                                </p>

                                <!-- Quick Capabilities -->
                                <div class="ai-capabilities">
                                    <div class="capability-card"
                                        onclick="sendQuickMessage('ÿßÿ¥ÿ±ÿ≠ ŸÑŸä ŸÖŸÅŸáŸàŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä')">
                                        <div class="capability-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10" />
                                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                                <line x1="12" y1="17" x2="12.01" y2="17" />
                                            </svg>
                                        </div>
                                        <span data-i18n="explainConcepts">ÿßÿ¥ÿ±ÿ≠ ÿßŸÑŸÖŸÅÿßŸáŸäŸÖ</span>
                                    </div>
                                    <div class="capability-card"
                                        onclick="sendQuickMessage('ÿ≥ÿßÿπÿØŸÜŸä ŸÅŸä ŸÉÿ™ÿßÿ®ÿ© ŸÉŸàÿØ ÿ®ÿ±ŸÖÿ¨Ÿä')">
                                        <div class="capability-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <polyline points="16 18 22 12 16 6" />
                                                <polyline points="8 6 2 12 8 18" />
                                            </svg>
                                        </div>
                                        <span data-i18n="writeCode">ÿßŸÉÿ™ÿ® ŸÉŸàÿØ</span>
                                    </div>
                                    <div class="capability-card" onclick="sendQuickMessage('ÿ≠ŸÑŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™')">
                                        <div class="capability-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="20" x2="18" y2="10" />
                                                <line x1="12" y1="20" x2="12" y2="4" />
                                                <line x1="6" y1="20" x2="6" y2="14" />
                                            </svg>
                                        </div>
                                        <span data-i18n="analyzeData">ÿ≠ŸÑŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
                                    </div>
                                    <div class="capability-card" onclick="sendQuickMessage('ÿ™ÿ±ÿ¨ŸÖ Ÿáÿ∞ÿß ÿßŸÑŸÜÿµ')">
                                        <div class="capability-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M5 8l6 6" />
                                                <path d="M4 14l6-6 2-3" />
                                                <path d="M2 5h12" />
                                                <path d="M7 2h1" />
                                                <path d="M22 22l-5-10-5 10" />
                                                <path d="M14 18h6" />
                                            </svg>
                                        </div>
                                        <span data-i18n="translate">ÿ™ÿ±ÿ¨ŸÖ ŸÜÿµÿßŸã</span>
                                    </div>
                                </div>

                                <!-- Suggested Prompts -->
                                <div class="suggested-prompts">
                                    <p class="prompts-title" data-i18n="tryAsking">ÿ¨ÿ±ÿ® ÿ£ŸÜ ÿ™ÿ≥ÿ£ŸÑ:</p>
                                    <div class="prompts-grid">
                                        <button class="prompt-chip"
                                            onclick="sendQuickMessage('ŸÖÿß ŸáŸä ÿ£ŸÅÿ∂ŸÑ ŸÖŸÖÿßÿ±ÿ≥ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©ÿü')">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <polygon
                                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                                            </svg>
                                            ÿ£ŸÅÿ∂ŸÑ ŸÖŸÖÿßÿ±ÿ≥ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©
                                        </button>
                                        <button class="prompt-chip"
                                            onclick="sendQuickMessage('ÿßŸÉÿ™ÿ® ŸÑŸä ŸÇÿµÿ© ŸÇÿµŸäÿ±ÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ©')">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M12 19l7-7 3 3-7 7-3-3z" />
                                                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" />
                                            </svg>
                                            ŸÇÿµÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ©
                                        </button>
                                        <button class="prompt-chip"
                                            onclick="sendQuickMessage('ŸÉŸäŸÅ ÿ£ÿ™ÿπŸÑŸÖ machine learningÿü')">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                                            </svg>
                                            ÿ™ÿπŸÑŸÖ Machine Learning
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Input Area -->
                        <div class="chat-input-area-enhanced">
                            <!-- Attachments Preview -->
                            <div class="attachments-preview" id="attachmentsPreview" style="display: none;">
                                <div class="attachments-list" id="attachmentsList"></div>
                            </div>

                            <!-- Main Input Container -->
                            <div class="input-container-modern">
                                <div class="input-tools-left">
                                    <button class="tool-btn" onclick="attachFile()" title="ÿ•ÿ±ŸÅÿßŸÇ ŸÖŸÑŸÅ">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path
                                                d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                                        </svg>
                                    </button>
                                    <button class="tool-btn" onclick="insertEmoji()" title="ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10" />
                                            <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                                            <line x1="9" y1="9" x2="9.01" y2="9" />
                                            <line x1="15" y1="9" x2="15.01" y2="9" />
                                        </svg>
                                    </button>
                                </div>

                                <div class="input-field-wrapper">
                                    <textarea id="messageInput"
                                        placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß... ÿßÿ≥ÿ™ÿÆÿØŸÖ @ ŸÑŸÑÿ•ÿ¥ÿßÿ±ÿ©ÿå / ŸÑŸÑÿ£ŸàÿßŸÖÿ±"
                                        data-i18n-placeholder="typeMessageAdvanced" rows="1"
                                        onkeydown="handleInputKeydown(event)"
                                        oninput="autoResizeTextarea(this)"></textarea>
                                    <div class="input-char-count" id="charCount">0</div>
                                </div>

                                <div class="input-tools-right">
                                    <button class="tool-btn voice-btn" onclick="toggleVoiceInput()" title="ÿ•ÿØÿÆÿßŸÑ ÿµŸàÿ™Ÿä"
                                        id="voiceBtn">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                            <line x1="12" y1="19" x2="12" y2="23" />
                                            <line x1="8" y1="23" x2="16" y2="23" />
                                        </svg>
                                        <div class="voice-wave" id="voiceWave">
                                            <span></span><span></span><span></span><span></span>
                                        </div>
                                    </button>
                                    <button class="send-btn-modern" onclick="handleSendButton()" id="sendBtn">
                                        <svg id="sendIcon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <line x1="22" y1="2" x2="11" y2="13" />
                                            <polygon points="22 2 15 22 11 13 2 9 22 2" />
                                        </svg>
                                        <svg id="stopIcon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2" style="display: none;">
                                            <rect x="6" y="6" width="12" height="12" rx="2" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Input Hints -->
                            <div class="input-hints">
                                <span class="hint-item">
                                    <kbd>Enter</kbd> ÿ•ÿ±ÿ≥ÿßŸÑ
                                </span>
                                <span class="hint-item">
                                    <kbd>Shift+Enter</kbd> ÿ≥ÿ∑ÿ± ÿ¨ÿØŸäÿØ
                                </span>
                                <span class="hint-item">
                                    <kbd>/</kbd> ÿ£ŸàÿßŸÖÿ± ÿ≥ÿ±Ÿäÿπÿ©
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Window - Advanced -->
            <div class="app-window settings-window-large" id="settingsWindow" style="display: none;">
                <div class="window-header">
                    <div class="window-title">
                        <div class="window-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                            </svg>
                        </div>
                        <span data-i18n="settings">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-btn minimize" onclick="minimizeWindow('settingsWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M5 12h14" />
                            </svg>
                        </button>
                        <button class="window-btn maximize" onclick="toggleMaximize('settingsWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" />
                            </svg>
                        </button>
                        <button class="window-btn close" onclick="closeWindow('settingsWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="window-content settings-layout">
                    <!-- Settings Sidebar -->
                    <div class="settings-sidebar">
                        <div class="settings-nav">
                            <button class="settings-nav-item active" onclick="showSettingsTab('general')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="3" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09" />
                                </svg>
                                <span data-i18n="generalTab">ÿπÿßŸÖ</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('ai')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z" />
                                </svg>
                                <span data-i18n="aiTab">ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('chat')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                </svg>
                                <span data-i18n="chatTab">ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('voice')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                    <line x1="12" y1="19" x2="12" y2="23" />
                                    <line x1="8" y1="23" x2="16" y2="23" />
                                </svg>
                                <span data-i18n="voiceTab">ÿßŸÑÿµŸàÿ™ ŸàÿßŸÑŸÜÿ∑ŸÇ</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('privacy')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                </svg>
                                <span data-i18n="privacyTab">ÿßŸÑÿÆÿµŸàÿµŸäÿ© ŸàÿßŸÑÿ£ŸÖÿßŸÜ</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('notifications')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                                </svg>
                                <span data-i18n="notificationsTab">ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('accessibility')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10" />
                                    <circle cx="12" cy="10" r="3" />
                                    <path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662" />
                                </svg>
                                <span data-i18n="accessibilityTab">ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿßŸÑŸàÿµŸàŸÑ</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('advanced')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polyline points="16 18 22 12 16 6" />
                                    <polyline points="8 6 2 12 8 18" />
                                </svg>
                                <span data-i18n="advancedTab">ŸÖÿ™ŸÇÿØŸÖ</span>
                            </button>
                            <button class="settings-nav-item" onclick="showSettingsTab('about')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10" />
                                    <line x1="12" y1="16" x2="12" y2="12" />
                                    <line x1="12" y1="8" x2="12.01" y2="8" />
                                </svg>
                                <span data-i18n="aboutTab">ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</span>
                            </button>
                        </div>
                    </div>

                    <!-- Settings Content -->
                    <div class="settings-content-area">
                        <!-- General Settings -->
                        <div class="settings-tab active" id="tab-general">
                            <h2 class="settings-tab-title" data-i18n="generalSettings">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="languageRegion">ÿßŸÑŸÑÿ∫ÿ© ŸàÿßŸÑŸÖŸÜÿ∑ŸÇÿ©</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="interfaceLanguage">ŸÑÿ∫ÿ© ÿßŸÑŸàÿßÿ¨Ÿáÿ©</span>
                                        <span class="setting-desc" data-i18n="chooseAppLanguage">ÿßÿÆÿ™ÿ± ŸÑÿ∫ÿ© ÿπÿ±ÿ∂
                                            ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</span>
                                    </div>
                                    <div class="language-toggle">
                                        <button class="lang-btn {{ 'active' if lang == 'ar' else '' }}"
                                            onclick="setLanguage('ar')">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
                                        <button class="lang-btn {{ 'active' if lang == 'en' else '' }}"
                                            onclick="setLanguage('en')">English</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="timezone">ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©</span>
                                        <span class="setting-desc" data-i18n="timezoneForDates">ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©
                                            ŸÑŸÑÿ™Ÿàÿßÿ±ŸäÿÆ</span>
                                    </div>
                                    <select class="settings-select" id="timezoneSelect">
                                        <option value="Asia/Riyadh">ÿßŸÑÿ±Ÿäÿßÿ∂ (GMT+3)</option>
                                        <option value="Asia/Dubai">ÿØÿ®Ÿä (GMT+4)</option>
                                        <option value="Africa/Cairo">ÿßŸÑŸÇÿßŸáÿ±ÿ© (GMT+2)</option>
                                        <option value="Europe/London">ŸÑŸÜÿØŸÜ (GMT+0)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="appearance">ÿßŸÑŸÖÿ∏Ÿáÿ±</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="autoDarkMode">ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ
                                            ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
                                        <span class="setting-desc" data-i18n="autoDarkNight">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                                            ŸÑŸäŸÑÿßŸã</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoDarkMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="animations">ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ŸÉÿ©</span>
                                        <span class="setting-desc" data-i18n="enableAnimations">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™
                                            ŸàÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑÿßÿ™</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="animationsEnabled" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- AI Settings -->
                        <div class="settings-tab" id="tab-ai">
                            <h2 class="settings-tab-title" data-i18n="aiSettings">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="baseModel">ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="serviceProvider">ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©</span>
                                        <span class="setting-desc" data-i18n="chooseAIProvider">ÿßÿÆÿ™ÿ± ŸÖÿ≤ŸàÿØ ÿÆÿØŸÖÿ© ÿßŸÑÿ∞ŸÉÿßÿ°
                                            ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</span>
                                    </div>
                                    <select class="settings-select" id="aiProvider">
                                        <option value="openai">OpenAI</option>
                                        <option value="anthropic">Anthropic (Claude)</option>
                                        <option value="google">Google (Gemini)</option>
                                        <option value="mistral">Mistral AI</option>
                                        <option value="groq">Groq</option>
                                        <option value="local">ŸÜŸÖŸàÿ∞ÿ¨ ŸÖÿ≠ŸÑŸä (Ollama)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="model">ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨</span>
                                        <span class="setting-desc" data-i18n="chooseAIModel">ÿßÿÆÿ™ÿ± ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ°
                                            ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</span>
                                    </div>
                                    <select class="settings-select" id="aiModelSelect">
                                        <option value="gpt-4o">GPT-4o (ÿßŸÑÿ£ÿ≠ÿØÿ´)</option>
                                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                        <option value="gpt-4">GPT-4</option>
                                        <option value="claude-3-opus">Claude 3 Opus</option>
                                        <option value="claude-3-sonnet">Claude 3.5 Sonnet</option>
                                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                        <option value="gemini-pro">Gemini Pro</option>
                                    </select>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="generationCriteria">ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ™ŸàŸÑŸäÿØ</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="creativityLevel">ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπŸäÿ©
                                            (Temperature)</span>
                                        <span class="setting-desc" data-i18n="higherValuesCreative">ŸÇŸäŸÖÿ© ÿ£ÿπŸÑŸâ = ÿ•ÿ¨ÿßÿ®ÿßÿ™
                                            ÿ£ŸÉÿ´ÿ± ÿ•ÿ®ÿØÿßÿπÿßŸã</span>
                                    </div>
                                    <div class="slider-container">
                                        <input type="range" class="settings-slider" id="temperatureSlider" min="0"
                                            max="100" value="70">
                                        <span class="slider-value" id="temperatureValue">0.7</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="maxTokens">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑÿ±ŸÖŸàÿ≤</span>
                                        <span class="setting-desc" data-i18n="responseLength">ÿ£ŸÇÿµŸâ ÿ∑ŸàŸÑ ŸÑŸÑÿ±ÿØ</span>
                                    </div>
                                    <select class="settings-select" id="maxTokens">
                                        <option value="1024">1,024 (ŸÇÿµŸäÿ±)</option>
                                        <option value="2048" selected>2,048 (ŸÖÿ™Ÿàÿ≥ÿ∑)</option>
                                        <option value="4096">4,096 (ÿ∑ŸàŸäŸÑ)</option>
                                        <option value="8192">8,192 (ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã)</option>
                                        <option value="16384">16,384 (ÿ£ŸÇÿµŸâ)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="topP">Top P (ÿ™ŸÜŸàÿπ ÿßŸÑŸÉŸÑŸÖÿßÿ™)</span>
                                        <span class="setting-desc" data-i18n="controlResponseDiversity">ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿ™ŸÜŸàÿπ
                                            ÿßŸÑÿ±ÿØŸàÿØ</span>
                                    </div>
                                    <div class="slider-container">
                                        <input type="range" class="settings-slider" id="topPSlider" min="0" max="100"
                                            value="90">
                                        <span class="slider-value" id="topPValue">0.9</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="assistantPersonality">ÿ¥ÿÆÿµŸäÿ© ÿßŸÑŸÖÿ≥ÿßÿπÿØ</h3>
                                <div class="setting-item full-width">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="systemPrompt">ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ (System
                                            Prompt)</span>
                                        <span class="setting-desc" data-i18n="defineBehavior">ÿ≠ÿØÿØ ÿ≥ŸÑŸàŸÉ Ÿàÿ¥ÿÆÿµŸäÿ©
                                            ÿßŸÑŸÖÿ≥ÿßÿπÿØ</span>
                                    </div>
                                    <textarea class="settings-textarea" id="systemPrompt"
                                        placeholder="ÿ£ŸÜÿ™ ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉŸä ŸàŸÖŸÅŸäÿØ...">ÿ£ŸÜÿ™ ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿ™ŸÇÿØŸÖ. ÿ™ÿ™ÿ≠ÿØÿ´ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ®ÿ∑ŸÑÿßŸÇÿ© Ÿàÿ™ŸÇÿØŸÖ ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿØŸÇŸäŸÇÿ© ŸàŸÖŸÅŸäÿØÿ©.</textarea>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="expertMode">Ÿàÿ∂ÿπ ÿßŸÑÿÆÿ®Ÿäÿ±</span>
                                        <span class="setting-desc" data-i18n="detailedTechnical">ÿ±ÿØŸàÿØ ÿ£ŸÉÿ´ÿ± ÿ™ŸÅÿµŸäŸÑÿßŸã
                                            Ÿàÿ™ŸÇŸÜŸäÿ©</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="expertMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Settings -->
                        <div class="settings-tab" id="tab-chat">
                            <h2 class="settings-tab-title" data-i18n="chatSettings">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="messageDisplay">ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="showTimestamps">ÿπÿ±ÿ∂ ÿßŸÑŸàŸÇÿ™ ŸÖÿπ
                                            ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</span>
                                        <span class="setting-desc" data-i18n="displayMessageTime">ÿ•ÿ∏Ÿáÿßÿ± ŸàŸÇÿ™ ÿ•ÿ±ÿ≥ÿßŸÑ ŸÉŸÑ
                                            ÿ±ÿ≥ÿßŸÑÿ©</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="showTimestamps" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="liveStreaming">ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑÿ±ÿØŸàÿØ</span>
                                        <span class="setting-desc" data-i18n="displayCharacterByCharacter">ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿØ
                                            ÿ≠ÿ±ŸÅÿßŸã ÿ™ŸÑŸà ÿßŸÑÿ¢ÿÆÿ±</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="streamResponses" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="markdownFormatting">ÿ™ŸÜÿ≥ŸäŸÇ Markdown</span>
                                        <span class="setting-desc" data-i18n="supportFormatting">ÿØÿπŸÖ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ŸÅŸä
                                            ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="markdownEnabled" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="codeHighlighting">ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑŸÉŸàÿØ</span>
                                        <span class="setting-desc" data-i18n="colorCode">ÿ™ŸÑŸàŸäŸÜ ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="codeHighlight" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="historyMemory">ÿßŸÑÿ≥ÿ¨ŸÑ ŸàÿßŸÑÿ∞ÿßŸÉÿ±ÿ©</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="autoSaveHistory">ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ¨ŸÑ
                                            ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã</span>
                                        <span class="setting-desc" data-i18n="saveConversations">ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ŸÑŸÑÿ±ÿ¨Ÿàÿπ
                                            ÿ•ŸÑŸäŸáÿß</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoSaveHistory" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="contextMemory">ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑÿ≥ŸäÿßŸÇ</span>
                                        <span class="setting-desc" data-i18n="savedMessages">ÿπÿØÿØ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÅŸä
                                            ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©</span>
                                    </div>
                                    <select class="settings-select" id="contextMemory">
                                        <option value="5">5 ÿ±ÿ≥ÿßÿ¶ŸÑ</option>
                                        <option value="10" selected>10 ÿ±ÿ≥ÿßÿ¶ŸÑ</option>
                                        <option value="20">20 ÿ±ÿ≥ÿßŸÑÿ©</option>
                                        <option value="50">50 ÿ±ÿ≥ÿßŸÑÿ©</option>
                                        <option value="0">ÿ®ŸÑÿß ÿ≠ÿØŸàÿØ</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="clearHistory">ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ</span>
                                        <span class="setting-desc" data-i18n="deleteSavedConversations">ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ
                                            ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©</span>
                                    </div>
                                    <button class="settings-btn danger" onclick="clearAllHistory()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6" />
                                            <path
                                                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                        </svg>
                                        <span data-i18n="clearAll">ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Voice Settings -->
                        <div class="settings-tab" id="tab-voice">
                            <h2 class="settings-tab-title" data-i18n="voiceSpeechSettings">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™ ŸàÿßŸÑŸÜÿ∑ŸÇ</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="voiceInput">ÿßŸÑÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿµŸàÿ™Ÿä</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="enableVoiceInput">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
                                            ÿßŸÑÿµŸàÿ™Ÿä</span>
                                        <span class="setting-desc" data-i18n="speakInsteadWrite">ÿßŸÑÿ™ÿ≠ÿØÿ´ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ
                                            ÿßŸÑŸÉÿ™ÿßÿ®ÿ©</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="voiceInputEnabled" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="speechLanguage">ŸÑÿ∫ÿ© ÿßŸÑÿ™ÿπÿ±ŸÅ ÿßŸÑÿµŸàÿ™Ÿä</span>
                                        <span class="setting-desc" data-i18n="languageToText">ŸÑÿ∫ÿ© ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ™ ŸÑŸÜÿµ</span>
                                    </div>
                                    <select class="settings-select" id="speechLang">
                                        <option value="ar-SA">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©)</option>
                                        <option value="ar-EG">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (ŸÖÿµÿ±)</option>
                                        <option value="ar-AE">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™)</option>
                                        <option value="en-US">English (US)</option>
                                        <option value="en-GB">English (UK)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="autoSend">ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
                                        <span class="setting-desc" data-i18n="sendMessageAuto">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                                            ÿ®ÿπÿØ ÿßŸÑÿ™ÿ≠ÿØÿ´</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoSendVoice">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="textToSpeech">ÿßŸÑŸÜÿ∑ŸÇ (Text-to-Speech)</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="readResponses">ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ±ÿØŸàÿØ ÿµŸàÿ™ŸäÿßŸã</span>
                                        <span class="setting-desc" data-i18n="readAssistantResponses">ŸÜÿ∑ŸÇ ÿ±ÿØŸàÿØ
                                            ÿßŸÑŸÖÿ≥ÿßÿπÿØ</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="ttsEnabled">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="speechVoice">ÿµŸàÿ™ ÿßŸÑŸÜÿ∑ŸÇ</span>
                                        <span class="setting-desc" data-i18n="chooseReadingVoice">ÿßÿÆÿ™ÿ± ÿµŸàÿ™
                                            ÿßŸÑŸÇÿ±ÿßÿ°ÿ©</span>
                                    </div>
                                    <select class="settings-select" id="ttsVoice">
                                        <option value="default">ÿßŸÑÿµŸàÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</option>
                                        <option value="female">ÿµŸàÿ™ ÿ£ŸÜÿ´ŸàŸä</option>
                                        <option value="male">ÿµŸàÿ™ ÿ∞ŸÉŸàÿ±Ÿä</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="speechSpeed">ÿ≥ÿ±ÿπÿ© ÿßŸÑŸÜÿ∑ŸÇ</span>
                                        <span class="setting-desc" data-i18n="textReadingSpeed">ÿ≥ÿ±ÿπÿ© ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÜÿµ</span>
                                    </div>
                                    <div class="slider-container">
                                        <input type="range" class="settings-slider" id="ttsSpeed" min="50" max="200"
                                            value="100">
                                        <span class="slider-value" id="ttsSpeedValue">1x</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Privacy Settings -->
                        <div class="settings-tab" id="tab-privacy">
                            <h2 class="settings-tab-title" data-i18n="privacySecurity">ÿßŸÑÿÆÿµŸàÿµŸäÿ© ŸàÿßŸÑÿ£ŸÖÿßŸÜ</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="data">ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="shareAnalytics">ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ŸäÿßŸÜÿßÿ™
                                            ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜ</span>
                                        <span class="setting-desc" data-i18n="helpImproveService">ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿ™ÿ≠ÿ≥ŸäŸÜ
                                            ÿßŸÑÿÆÿØŸÖÿ©</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="shareAnalytics">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="endToEndEncryption">ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ŸÖŸÜ ÿ∑ÿ±ŸÅ
                                            ŸÑÿ∑ÿ±ŸÅ</span>
                                        <span class="setting-desc" data-i18n="encryptConversations">ÿ™ÿ¥ŸÅŸäÿ±
                                            ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="e2eEncryption" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="deleteLocalData">ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                                            ÿßŸÑŸÖÿ≠ŸÑŸäÿ©</span>
                                        <span class="setting-desc" data-i18n="clearStoredData">ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                                            ÿßŸÑŸÖÿÆÿ≤ŸÜÿ©</span>
                                    </div>
                                    <button class="settings-btn danger" onclick="clearLocalData()">
                                        <span data-i18n="deleteData">ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
                                    </button>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="session">ÿßŸÑÿ¨ŸÑÿ≥ÿ©</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="autoLogout">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
                                        <span class="setting-desc" data-i18n="afterInactivity">ÿ®ÿπÿØ ŸÅÿ™ÿ±ÿ© ŸÖŸÜ ÿπÿØŸÖ
                                            ÿßŸÑŸÜÿ¥ÿßÿ∑</span>
                                    </div>
                                    <select class="settings-select" id="autoLogout">
                                        <option value="0">ŸÖÿπÿ∑ŸÑ</option>
                                        <option value="15">15 ÿØŸÇŸäŸÇÿ©</option>
                                        <option value="30">30 ÿØŸÇŸäŸÇÿ©</option>
                                        <option value="60">ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Settings -->
                        <div class="settings-tab" id="tab-notifications">
                            <h2 class="settings-tab-title" data-i18n="notificationsSettings">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="notifications">ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="enableNotifications">ÿ™ŸÅÿπŸäŸÑ
                                            ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</span>
                                        <span class="setting-desc" data-i18n="receiveAppNotifications">ÿ™ŸÑŸÇŸä ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
                                            ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notificationsEnabled" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="notificationSound">ÿµŸàÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</span>
                                        <span class="setting-desc" data-i18n="playSound">ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿπŸÜÿØ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notificationSound" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="desktopNotifications">ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ≥ÿ∑ÿ≠
                                            ÿßŸÑŸÖŸÉÿ™ÿ®</span>
                                        <span class="setting-desc" data-i18n="showBrowserNotifications">ÿπÿ±ÿ∂ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
                                            ÿßŸÑŸÖÿ™ÿµŸÅÿ≠</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="desktopNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Accessibility Settings -->
                        <div class="settings-tab" id="tab-accessibility">
                            <h2 class="settings-tab-title" data-i18n="accessibilitySettings">ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿßŸÑŸàÿµŸàŸÑ</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="display">ÿßŸÑÿπÿ±ÿ∂</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="fontSize">ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑</span>
                                        <span class="setting-desc" data-i18n="enlargeShrinkText">ÿ™ŸÉÿ®Ÿäÿ± ÿ£Ÿà ÿ™ÿµÿ∫Ÿäÿ±
                                            ÿßŸÑŸÜÿµ</span>
                                    </div>
                                    <select class="settings-select" id="fontSize">
                                        <option value="small">ÿµÿ∫Ÿäÿ±</option>
                                        <option value="medium" selected>ŸÖÿ™Ÿàÿ≥ÿ∑</option>
                                        <option value="large">ŸÉÿ®Ÿäÿ±</option>
                                        <option value="xlarge">ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="highContrast">ÿ™ÿ®ÿßŸäŸÜ ÿπÿßŸÑŸä</span>
                                        <span class="setting-desc" data-i18n="increaseColorClarity">ÿ≤ŸäÿßÿØÿ© Ÿàÿ∂Ÿàÿ≠
                                            ÿßŸÑÿ£ŸÑŸàÿßŸÜ</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="highContrast">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="reduceMotion">ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ©</span>
                                        <span class="setting-desc" data-i18n="disableAnimations">ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="reduceMotion">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="screenReader">ŸÇÿßÿ±ÿ¶ ÿßŸÑÿ¥ÿßÿ¥ÿ©</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="screenReaderSupport">ÿØÿπŸÖ ŸÇÿßÿ±ÿ¶
                                            ÿßŸÑÿ¥ÿßÿ¥ÿ©</span>
                                        <span class="setting-desc" data-i18n="improveForVisuallyImpaired">ÿ™ÿ≠ÿ≥ŸäŸÜ
                                            ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖŸÉŸÅŸàŸÅŸäŸÜ</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="screenReaderMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="settings-tab" id="tab-advanced">
                            <h2 class="settings-tab-title" data-i18n="advancedSettings">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©</h2>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="apiConnection">API ŸàÿßŸÑÿßÿ™ÿµÿßŸÑ</h3>
                                <div class="setting-item full-width">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="apiKey">ŸÖŸÅÿ™ÿßÿ≠ API</span>
                                        <span class="setting-desc" data-i18n="accessKey">ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿÆÿØŸÖÿ©</span>
                                    </div>
                                    <div class="api-key-input">
                                        <input type="password" class="settings-input" id="apiKeyInput"
                                            placeholder="sk-...">
                                        <button class="settings-btn" onclick="toggleApiKeyVisibility()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                                <circle cx="12" cy="12" r="3" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="setting-item full-width">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="endpoint">ŸÜŸÇÿ∑ÿ© ÿßŸÑŸÜŸáÿßŸäÿ© (Endpoint)</span>
                                        <span class="setting-desc" data-i18n="customAPIAddress">ÿπŸÜŸàÿßŸÜ API ÿßŸÑŸÖÿÆÿµÿµ</span>
                                    </div>
                                    <input type="text" class="settings-input" id="apiEndpoint"
                                        placeholder="https://api.openai.com/v1">
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="connectionTimeout">ŸÖŸáŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ</span>
                                        <span class="setting-desc" data-i18n="maxWaitResponse">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
                                            ÿßŸÑÿ±ÿØ</span>
                                    </div>
                                    <select class="settings-select" id="connectionTimeout">
                                        <option value="30">30 ÿ´ÿßŸÜŸäÿ©</option>
                                        <option value="60" selected>60 ÿ´ÿßŸÜŸäÿ©</option>
                                        <option value="120">120 ÿ´ÿßŸÜŸäÿ©</option>
                                        <option value="300">5 ÿØŸÇÿßÿ¶ŸÇ</option>
                                    </select>
                                </div>
                            </div>

                            <div class="settings-group">
                                <h3 class="settings-group-title" data-i18n="developer">ÿßŸÑŸÖÿ∑Ÿàÿ±</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="debugMode">Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿµÿ≠Ÿäÿ≠</span>
                                        <span class="setting-desc" data-i18n="showDevLogs">ÿπÿ±ÿ∂ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="debugMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="exportSettings">ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                                        <span class="setting-desc" data-i18n="saveAsFile">ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÉŸÖŸÑŸÅ</span>
                                    </div>
                                    <button class="settings-btn" onclick="exportSettings()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                            <polyline points="7 10 12 15 17 10" />
                                            <line x1="12" y1="15" x2="12" y2="3" />
                                        </svg>
                                        <span data-i18n="export">ÿ™ÿµÿØŸäÿ±</span>
                                    </button>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="importSettings">ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                                        <span class="setting-desc" data-i18n="loadFromFile">ÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ</span>
                                    </div>
                                    <button class="settings-btn" onclick="importSettings()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                            <polyline points="17 8 12 3 7 8" />
                                            <line x1="12" y1="3" x2="12" y2="15" />
                                        </svg>
                                        <span data-i18n="import">ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ</span>
                                    </button>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label" data-i18n="reset">ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑</span>
                                        <span class="setting-desc" data-i18n="restoreDefaults">ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                                            ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©</span>
                                    </div>
                                    <button class="settings-btn danger" onclick="resetAllSettings()">
                                        <span data-i18n="resetSettings">ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- About -->
                        <div class="settings-tab" id="tab-about">
                            <h2 class="settings-tab-title" data-i18n="aboutApp">ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</h2>

                            <div class="about-card">
                                <div class="about-logo">
                                    <div class="about-logo-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="1.5">
                                            <path
                                                d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z" />
                                            <circle cx="7.5" cy="14.5" r="1.5" />
                                            <circle cx="16.5" cy="14.5" r="1.5" />
                                        </svg>
                                    </div>
                                    <div class="about-info">
                                        <h3>AI Assistant</h3>
                                        <span data-i18n="version">ÿßŸÑÿ•ÿµÿØÿßÿ±</span> 2.0.0
                                    </div>
                                </div>
                                <p class="about-desc">ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿ™ŸÇÿØŸÖ ŸÖÿ®ŸÜŸä ÿ®ÿ£ÿ≠ÿØÿ´ ÿ™ŸÇŸÜŸäÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä. ŸäÿØÿπŸÖ
                                    ŸÜŸÖÿßÿ∞ÿ¨ ŸÖÿ™ÿπÿØÿØÿ© ŸàŸäŸàŸÅÿ± ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ≥ŸÑÿ≥ÿ© Ÿàÿ∞ŸÉŸäÿ©.</p>

                                <div class="about-features">
                                    <div class="about-feature">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12" />
                                        </svg>
                                        <span data-i18n="multipleAIModels">ÿØÿπŸÖ ŸÜŸÖÿßÿ∞ÿ¨ AI ŸÖÿ™ÿπÿØÿØÿ©</span>
                                    </div>
                                    <div class="about-feature">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12" />
                                        </svg>
                                        <span data-i18n="fullArabicInterface">Ÿàÿßÿ¨Ÿáÿ© ÿπÿ±ÿ®Ÿäÿ© ŸÉÿßŸÖŸÑÿ©</span>
                                    </div>
                                    <div class="about-feature">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12" />
                                        </svg>
                                        <span data-i18n="voiceInputOutput">ÿ•ÿØÿÆÿßŸÑ ÿµŸàÿ™Ÿä ŸàŸÜÿ∑ŸÇ</span>
                                    </div>
                                    <div class="about-feature">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12" />
                                        </svg>
                                        <span data-i18n="encryptionDataProtection">ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ≠ŸÖÿßŸäÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
                                    </div>
                                </div>

                                <div class="about-links">
                                    <a href="#" class="about-link" data-i18n="privacyPolicy">ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿÆÿµŸàÿµŸäÿ©</a>
                                    <a href="#" class="about-link" data-i18n="termsOfUse">ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ</a>
                                    <a href="#" class="about-link" data-i18n="help">ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Window -->
            <div class="app-window" id="adminWindow" style="display: none;">
                <div class="window-header">
                    <div class="window-title">
                        <div class="window-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                                <path d="M2 17l10 5 10-5" />
                                <path d="M2 12l10 5 10-5" />
                            </svg>
                        </div>
                        <span data-i18n="controlPanel">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-btn minimize" onclick="minimizeWindow('adminWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M5 12h14" />
                            </svg>
                        </button>
                        <button class="window-btn maximize" onclick="toggleMaximize('adminWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" />
                            </svg>
                        </button>
                        <button class="window-btn close" onclick="closeWindow('adminWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="window-content">
                    <iframe src="/admin/theme" class="admin-iframe" id="adminIframe"></iframe>
                </div>
            </div>

            <!-- Widgets Window (like macOS widgets) -->
            <div class="app-window widget-window" id="widgetsWindow" style="display: none;">
                <div class="window-header">
                    <div class="window-title">
                        <div class="window-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                        </div>
                        <span data-i18n="widgets">ÿßŸÑÿ£ÿØŸàÿßÿ™</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-btn close" onclick="closeWindow('widgetsWindow')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="window-content widgets-grid">
                    <!-- Clock Widget -->
                    <div class="widget clock-widget">
                        <div class="widget-time" id="clockTime">12:00</div>
                        <div class="widget-date" id="clockDate">ÿßŸÑÿÆŸÖŸäÿ≥ÿå 5 ÿØŸäÿ≥ŸÖÿ®ÿ±</div>
                    </div>

                    <!-- Weather Widget -->
                    <div class="widget weather-widget">
                        <div class="weather-icon">üå§Ô∏è</div>
                        <div class="weather-temp">25¬∞</div>
                        <div class="weather-location">ÿßŸÑÿ±Ÿäÿßÿ∂</div>
                    </div>

                    <!-- Quick Stats Widget -->
                    <div class="widget stats-widget">
                        <h4 data-i18n="todayStats">ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖ</h4>
                        <div class="stat-item">
                            <span data-i18n="conversations">ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™</span>
                            <span class="stat-value">12</span>
                        </div>
                        <div class="stat-item">
                            <span data-i18n="messages">ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</span>
                            <span class="stat-value">48</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="taskbar-start">
                <button class="taskbar-btn start-btn" onclick="toggleStartMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                </button>
            </div>

            <div class="taskbar-center">
                <button class="taskbar-btn app-btn" onclick="window.location.href='/dashboard'"
                    data-i18n-title="Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="9" />
                        <rect x="14" y="3" width="7" height="5" />
                        <rect x="14" y="12" width="7" height="9" />
                        <rect x="3" y="16" width="7" height="5" />
                    </svg>
                </button>
                <button class="taskbar-btn app-btn" onclick="toggleWindow('chatWindow')" data-window="chatWindow"
                    data-i18n-title="chatTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                    </svg>
                </button>
                <button class="taskbar-btn app-btn" onclick="toggleWindow('widgetsWindow')" data-window="widgetsWindow"
                    data-i18n-title="widgetsTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                </button>
                <button class="taskbar-btn app-btn" onclick="toggleWindow('settingsWindow')"
                    data-window="settingsWindow" data-i18n-title="settingsTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                </button>
                {% if user_role == 'admin' %}
                <button class="taskbar-btn app-btn admin-btn" onclick="toggleWindow('adminWindow')"
                    data-window="adminWindow" data-i18n-title="controlPanelTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z" />
                        <path d="M2 17l10 5 10-5" />
                        <path d="M2 12l10 5 10-5" />
                    </svg>
                </button>
                {% endif %}
            </div>

            <div class="taskbar-end">
                <div class="system-tray">
                    <button class="tray-btn" onclick="toggleLanguage()">
                        <span id="currentLang">{{ 'ÿπ' if lang == 'ar' else 'EN' }}</span>
                    </button>
                    <div class="tray-time">
                        <span id="taskbarTime">12:00</span>
                        <span id="taskbarDate">5/12</span>
                    </div>
                </div>
                <div class="user-menu">
                    <button class="user-btn" onclick="toggleUserMenu()">
                        <div class="user-avatar">{{ session.get('name', 'U')[0] }}</div>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-info">
                            <div class="user-avatar large">{{ session.get('name', 'U')[0] }}</div>
                            <div class="user-details">
                                <span class="user-name">{{ session.get('name', 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ') }}</span>
                                <span class="user-email">{{ session.get('username', '') }}</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="/logout" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                <polyline points="16 17 21 12 16 7" />
                                <line x1="21" y1="12" x2="9" y2="12" />
                            </svg>
                            <span data-i18n="logout">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu" id="startMenu">
            <div class="start-menu-header">
                <input type="text" class="start-search" placeholder="ÿßÿ®ÿ≠ÿ´..." data-i18n-placeholder="search">
            </div>
            <div class="start-menu-apps">
                <div class="start-app" onclick="openWindow('chatWindow'); closeStartMenu();">
                    <div class="start-app-icon chat-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg>
                    </div>
                    <span data-i18n="aiChat">ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿ∞ŸÉŸäÿ©</span>
                </div>
                <div class="start-app" onclick="openWindow('widgetsWindow'); closeStartMenu();">
                    <div class="start-app-icon widgets-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg>
                    </div>
                    <span data-i18n="widgets">ÿßŸÑÿ£ÿØŸàÿßÿ™</span>
                </div>
                <div class="start-app" onclick="openWindow('settingsWindow'); closeStartMenu();">
                    <div class="start-app-icon settings-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09" />
                        </svg>
                    </div>
                    <span data-i18n="settings">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                </div>
                {% if user_role == 'admin' %}
                <div class="start-app" onclick="openWindow('adminWindow'); closeStartMenu();">
                    <div class="start-app-icon admin-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" />
                            <path d="M2 17l10 5 10-5" />
                            <path d="M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <span data-i18n="controlPanel">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</span>
                </div>
                {% endif %}
            </div>
            <div class="start-menu-footer">
                <button class="power-btn" onclick="window.location.href='/logout'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18.36 6.64a9 9 0 1 1-12.73 0" />
                        <line x1="12" y1="2" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Marked.js for Markdown parsing -->
    <script src="{{ url_for('static', filename='marked.min.js') }}?v={{ timestamp }}"></script>
    <script>
        // Verify marked.js is loaded
        console.log('Checking marked.js status...');
        if (typeof marked !== 'undefined') {
            console.log('‚úÖ Marked.js loaded. Type:', typeof marked);
            console.log('Keys:', Object.keys(marked));
            if (marked.parse) {
                console.log('‚úÖ marked.parse is available');
                console.log('Test parse:', marked.parse('**test**'));
            } else {
                console.error('‚ùå marked.parse is MISSING');
            }

            // Configure marked options
            try {
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: false,
                    mangle: false
                });
                console.log('‚úÖ Marked options set');
            } catch (e) {
                console.error('‚ùå Error setting options:', e);
            }
        } else {
            console.error('‚ùå Failed to load marked.js - marked is undefined');
        }
    </script>

    <!-- Currency Ticker Script -->
    <script>
        // Duplicate ticker content for seamless loop
        document.addEventListener('DOMContentLoaded', function () {
            const tickerContent = document.querySelector('.ticker-content');
            if (tickerContent) {
                const clone = tickerContent.innerHTML;
                tickerContent.innerHTML += clone; // Duplicate content for seamless loop
            }
        });
    </script>
    <script src="{{ url_for('static', filename='translations.js') }}?v={{ timestamp }}"></script>
    <script src="{{ url_for('static', filename='desktop.js') }}?v={{ timestamp }}"></script>
    <script>
        // Dynamic titles based on language
        const appTitles = {{ theme_settings.app_name| tojson }};
        const chatTitles = {{ theme_settings.chat_header_title| tojson }};

        // Update titles when language changes
        function updateDynamicTitles(lang) {
            const mainTitle = document.getElementById('mainAppTitle');
            const chatTitle = document.getElementById('chatAppTitle');
            const chatWindowTitle = document.getElementById('chatWindowTitle');
            const welcomeAppTitle = document.getElementById('welcomeAppTitle');
            const pageTitle = document.querySelector('title');

            if (mainTitle && appTitles && typeof appTitles === 'object') {
                mainTitle.textContent = appTitles[lang] || appTitles.ar || 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™';
            }

            if (chatWindowTitle && appTitles && typeof appTitles === 'object') {
                chatWindowTitle.textContent = appTitles[lang] || appTitles.ar || 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™';
            }

            if (welcomeAppTitle && appTitles && typeof appTitles === 'object') {
                welcomeAppTitle.textContent = appTitles[lang] || appTitles.ar || 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™';
            }

            if (pageTitle && appTitles && typeof appTitles === 'object') {
                pageTitle.textContent = appTitles[lang] || appTitles.ar || 'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™';
            }

            if (chatTitle && chatTitles && typeof chatTitles === 'object') {
                chatTitle.textContent = chatTitles[lang] || chatTitles.ar || 'ŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä';
            }
        }

        // Call on page load
        document.addEventListener('DOMContentLoaded', function () {
            const currentLang = document.documentElement.lang || 'ar';
            updateDynamicTitles(currentLang);
        });

        // Override setLanguage to update titles before reload
        const originalSetLanguage = window.setLanguage;
        if (originalSetLanguage) {
            window.setLanguage = function (lang) {
                updateDynamicTitles(lang);
                originalSetLanguage(lang);
            };
        }
    </script>
</body>

</html>